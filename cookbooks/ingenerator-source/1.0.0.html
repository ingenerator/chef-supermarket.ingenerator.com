<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MiniMart</title>

  <!-- fonts -->
  <link href='//fonts.googleapis.com/css?family=Maven+Pro:400,700' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Open+Sans:400,700,600' rel='stylesheet' type='text/css'>
  <!-- css -->
  <link rel="stylesheet" href="../../assets/stylesheets/application.min.css" />
  <!-- js -->
  <script src="../../assets/javascripts/application.min.js"></script>
</head>
<body>
  <a href="../../index.html">
  <header class="header-slim">
    <div class="header-slim__container">
      <h1 class="header-slim__title">Welcome to MiniMart</h1>
      <h2 class="header-slim__subtitle">Always open and always open sourced.</h2>
    </div>
  </header>
  </a>

  <div class="outer-wrapper">
    <form action="../../index.html#search/" method="GET" id="cookbook-search-form">
  <div class="search">
    <div class="search__td">
      <input name="query" type="search">
    </div>
    <div class="search__td search__td--btn">
      <button type="submit">Search</button>
    </div>
  </div>
</form>

<main class="detail-content">
  <h1 class="detail-content__title">
    ingenerator-source
    <span>
      (3) Versions
      <select class="cookbook-version-selector">
        <option disabled selected>
          <small>1.0.0</small>
        </option>
        
          
            <option value="../../cookbooks/ingenerator-source/2.0.0.html">2.0.0</option>
          
        
          
        
          
            <option value="../../cookbooks/ingenerator-source/0.1.0.html">0.1.0</option>
          
        
      </select>
    </span>
  </h1>

  <p>Manages deployment and provisioning of project source code on an instance, either live or VM</p>
  <code class="install-instructions">cookbook 'ingenerator-source', '~> 1.0.0'</code>

  <div class="tab-container">
    <ul class="detail-content__tabs">
      <li><a href="#readme-tab">Readme</a></li>
      <li><a href="#dependencies-tab">Dependencies</a></li>
      <li><a href="#changelog-tab">Changelog</a></li>
    </ul>

    <div id="readme-tab" class="markdown">
      <h1>inGenerator Source cookbook</h1>

<p><a href="https://travis-ci.org/ingenerator/chef-ingenerator-source"><img src="https://travis-ci.org/ingenerator/chef-ingenerator-source.png?branch=1.x" alt="Build Status"></a></p>

<p>The <code>ingenerator-source</code> cookbook provides a standard framework to manage deployment and provisioning of project source
code on an instance. This is used either for atomic checkouts on a live instance, or for running the same provisioning
and build code for a checkout on a development VM or build server.</p>

<h2>Requirements</h2>

<ul>
<li>Chef 12.13 or higher</li>
<li><strong>Ruby 2.3 or higher</strong></li>
</ul>

<h2>Installation</h2>

<p>We recommend adding to your <code>Berksfile</code> and using <a href="http://berkshelf.com/">Berkshelf</a>:</p>

<pre><code class="ruby">cookbook &#39;ingenerator-source&#39;, git: &#39;git://github.com/ingenerator/chef-ingenerator-source&#39;, branch: &#39;master&#39;
</code></pre>

<p>Have your main project cookbook <em>depend</em> on ingenerator-source by editing the <code>metadata.rb</code> for your cookbook.</p>

<pre><code class="ruby"># metadata.rb
depends &#39;ingenerator-source&#39;
</code></pre>

<h2>Usage</h2>

<p>There&#39;s probably a fair bit of &#39;deployment&#39; you still need to do on a local VM to get it up and running. You may need to
build assets, provision config files with details of database and API services, install composer dependencies etc. Much
of this provisioning is likely to overlap with the deployment/provisioning workflow on a live or build server. So this
cookbook wraps both types of operations together to make it easy to share details between both.</p>

<p>Your runlist just needs to include the <code>ingenerator-source::default</code> recipe and the rest of the process is controlled by
attributes.</p>

<h3><code>:in_place</code> provisioning - eg on a VM</h3>

<p>With in-place provisioning, the recipe simply creates a symlink from your deploy destination to the source path you
specify. There are no revision checkout folders, and if the source path is a vagrant share or similar you&#39;ll have a live
checkout. Once the symlink is in place the post-deploy hooks will execute as though following a deploy.</p>

<table><thead>
<tr>
<th>attribute</th>
<th>default</th>
<th>notes</th>
</tr>
</thead><tbody>
<tr>
<td>node[&#39;project&#39;][&#39;deploy&#39;][&#39;type&#39;]</td>
<td></td>
<td>set to <code>:in_place</code> to trigger this mode</td>
</tr>
<tr>
<td>node[&#39;project&#39;][&#39;deploy&#39;][&#39;source&#39;]</td>
<td>/vagrant</td>
<td>the location of your raw source files</td>
</tr>
<tr>
<td>node[&#39;project&#39;][&#39;deploy&#39;][&#39;destination&#39;]</td>
<td>/var/www/{project_name}/current</td>
<td>the base web path for your application</td>
</tr>
</tbody></table>

<h3><code>:deploy</code> - eg on a build or live server</h3>

<p>This is the default action.</p>

<p>The standard workflow is to check out the revision you want in a source repository on the instance - to get up to date
versions of the provisioning scripts etc - and then allow this cookbook to deploy a known checkout from there to the
web root using the chef deploy resource. Again, post-deploy hooks will execute at key points in the process.</p>

<table><thead>
<tr>
<th>attribute</th>
<th>default</th>
<th>notes</th>
</tr>
</thead><tbody>
<tr>
<td>node[&#39;project&#39;][&#39;deploy&#39;][&#39;type&#39;]</td>
<td>:deploy</td>
<td>set to <code>:deploy</code> to trigger this mode</td>
</tr>
<tr>
<td>node[&#39;project&#39;][&#39;deploy&#39;][&#39;force&#39;]</td>
<td>false</td>
<td>whether to force a redeploy of same rev</td>
</tr>
<tr>
<td>node[&#39;project&#39;][&#39;deploy&#39;][&#39;source&#39;]</td>
<td>/var/www/www-source</td>
<td>the location of your raw source files</td>
</tr>
<tr>
<td>node[&#39;project&#39;][&#39;deploy&#39;][&#39;destination&#39;]</td>
<td>/var/www/{project_name}/current</td>
<td>the base web path for your application</td>
</tr>
<tr>
<td>node[&#39;project&#39;][&#39;deploy&#39;][&#39;revision&#39;]</td>
<td>HEAD</td>
<td>you should checkout the desired rev first</td>
</tr>
</tbody></table>

<h3>Marking known-unstable branches</h3>

<p>You can prevent branches that you know to be unstable from making it into production accidentally. For example, if you are
part way through heavy refactoring of a legacy system and know there are problems that are not yet caught be your
unit/acceptance tests.</p>

<p>If the node&#39;s <code>project.deploy.allow_blocked_branch</code> is false (default) then the deploy run will throw an exception if a
PROD_RELEASE_BLOCKER file is found in the checkout root directory. You should add relevant information about why the
branch is blocked into this file.</p>

<p>If the <code>project.deploy.allow_blocked_branch</code> is true then the deploy run will issue a warning but continue. Build slaves
and potentially QA should have this attribute set to true.</p>

<h3>Deployment hooks</h3>

<p>You can provide recipes that run as callbacks before the checked out code is symlinked into
production, or immediately after the deploy completes. These have full access your recipes,
resources and the rest of the chef environment but note are <em>not</em> loaded until during the deployment
so they are not compiled as part of the main chef compile and in particular cannot include changes
to attributes, runlists etc that need to apply outside their own scope.</p>

<blockquote>
<p><em>Caution: Use the correct checkout directory in your hooks</em>
During a live deployment, the on_prepare callback is triggered before the symlink to your code has been updated.
You can get the path to the about-to-be-live code with the <code>this_release_path</code> helper method.
This will throw if you attempt to access it before the prepare_deploy stage of the deployment.</p>

<p>The on_complete hook can target either <code>this_release_path</code> or <code>node[&#39;project&#39;][&#39;deploy&#39;][&#39;destination&#39;]</code>
as these paths resolve the same by this point.</p>
</blockquote>

<table><thead>
<tr>
<th>attribute</th>
<th>default</th>
<th>called</th>
</tr>
</thead><tbody>
<tr>
<td><code>project.deploy.on_prepare</code></td>
<td>nil</td>
<td>after all files are checked out, before symlinking</td>
</tr>
<tr>
<td><code>project.deploy.on_complete</code></td>
<td>nil</td>
<td>after deploy linked into production</td>
</tr>
</tbody></table>

<pre><code class="ruby"> # Specify your prepare recipe
 default[&#39;project&#39;][&#39;deploy&#39;][&#39;on_prepare&#39;] = &#39;project::prepare_deploy&#39;

 # project/recipes/prepare_deploy.rb
 composer_dependencies this_release_path do
   run_as  node[&#39;apache&#39;][&#39;user&#39;]
 end
</code></pre>

<p>You can obviously make steps within your callbacks conditional on node attributes, etc, if required.</p>

<h3>Testing</h3>

<p>See the <a href=".travis.yml">.travis.yml</a> file for the current test scripts.</p>

<h2>Contributing</h2>

<ol>
<li>Fork the project</li>
<li>Create a feature branch corresponding to your change</li>
<li>Create specs for your change</li>
<li>Create your changes</li>
<li>Create a Pull Request on github</li>
</ol>

<h2>License &amp; Authors</h2>

<ul>
<li>Author:: Andrew Coulton (<a href="mailto:andrew@ingenerator.com">andrew@ingenerator.com</a>)</li>
</ul>

<pre><code class="text">Copyright 2012-2013, inGenerator Ltd

Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>

    </div>

    <div id="dependencies-tab">
      
        <p>This cookbook has no dependencies.</p>
      
    </div>

    <div id="changelog-tab" class="markdown">
      <h1>Change Log</h1>

<p>All notable changes to this project will be documented in this file.
This project adheres to <a href="http://semver.org/">Semantic Versioning</a>. Note that
0.x versions may be breaking, per the semver standard.</p>

<h2>Unreleased</h2>

<h2>1.0.0 (2017-02-24)</h2>

<ul>
<li>[BREAKING] Remove the default prepare_deploy and complete_deploy recipes - these
were only being used to verify the path was set and the new helper does that
better.</li>
<li>[BREAKING] Current release path is no longer set in node.deploy.release_path -
instead you must use <code>this_release_path</code> which will throw if it hasn&#39;t been
set (because deployment hasn&#39;t happened yet) when called.</li>
<li>[BREAKING] No longer attempts to automatically install composer packages for
a prepare_deploy - do this in your project if you need it.</li>
</ul>

<h2>0.1.0 (2017-02-24)</h2>

<ul>
<li>First tagged release</li>
</ul>

    </div>
  </div>
</main>


<div class="detail-sidebar">
  <h4>Added to MiniMart</h4>
  <p>September 02, 2021</p>
  <h4>Maintainer</h4>
  <p>Andrew Coulton</p>
  <dl class="platform-list">
    <dt>Supported Platforms</dt>
    
      <dd><i class="icon-ubuntu" title="Ubuntu"></i></dd>
    
  </dl>
  
  <a href="https://github.com/ingenerator/chef-ingenerator-source" class="button detail-sidebar__halfbutton">Source</a>
  
  
  <a href="https://github.com/ingenerator/chef-ingenerator-source/issues" class="button detail-sidebar__halfbutton">Issues</a>
  
  <a href="../../cookbook_files/ingenerator-source/1_0_0/ingenerator-source-1.0.0.tar.gz" class="button detail-sidebar__button">Download</a>
</div>

<script>
$(function () {
  $('.tab-container').tabslet();
  $('.cookbook-version-selector').change(function () {
    document.location.href = encodeURI($(this).val());
  });
  $('#cookbook-search-form').submit(function (ev) {
    ev.preventDefault();
    var searchValue, searchPath;
    searchValue = $(this).find('input[name="query"]').val();
    searchPath  = $(this).attr('action');
    document.location.href = encodeURI(searchPath + searchValue);
  });
});
</script>

  </div>

  <footer class="footer">
    <a href="http://www.madglory.com" target="_blank">
      Powered by
      <span class="footer__logo">
        <img src="../../assets/images/mad-glory-logo.png" alt="Mad Glory" />
      </span>
    </a>
  </footer>
</body>
</html>
